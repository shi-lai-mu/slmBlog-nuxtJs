{"version":3,"file":"pages/article/editArticle.js","sources":["webpack:///./pages/article/editArticle.vue?c8aa","webpack:///./pages/article/editArticle.vue","webpack:///./pages/article/editArticle.vue?cf7d","webpack:///./pages/article/editArticle.vue?754c","webpack:///./node_modules/_wangeditor@3.1.1@wangeditor/release/wangEditor.css","webpack:///./pages/article/editArticle.vue?896f","webpack:///./plugins/Editor.vue?7c65","webpack:///./plugins/Editor.vue","webpack:///./plugins/Editor.vue?664a","webpack:///./plugins/Editor.vue?5d01","webpack:///./pages/article/editArticle.vue?a694"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"conter single clearfix\"},[_vm._ssrNode(\"<div class=\\\"content-box addArticle\\\">\",\"</div>\",[_vm._ssrNode(\"<ul class=\\\"form\\\"><li><label>标题</label> <input type=\\\"text\\\"\"+(_vm._ssrAttr(\"value\",(_vm.title)))+\"> <span class=\\\"bust\\\">*</span></li> <li><label>分类</label> <input type=\\\"text\\\" placeholder=\\\"#隔开\\\"\"+(_vm._ssrAttr(\"value\",(_vm.type)))+\"> <span class=\\\"bust\\\">*</span></li> <li><label>简介</label> <input type=\\\"text\\\" placeholder=\\\"简短的介绍文章内容\\\"\"+(_vm._ssrAttr(\"value\",(_vm.description)))+\"> <span class=\\\"bust\\\">*</span></li> <li><input type=\\\"file\\\" id=\\\"upload_file\\\" accept=\\\"image/gif,image/jpeg,image/jpg,image/png\\\" style=\\\"display: none\\\"> \"+((!_vm.webInput)?(\"<button onclick=\\\"upload_file.click()\\\" class=\\\"button-lv1 upload_file\\\">\"+_vm._ssrEscape(_vm._s(_vm.filePath ? '重新选择' : '上传本地封面'))+\"</button>\"):\"<!---->\")+\" \"+((!_vm.filePath)?(\"<button class=\\\"button-lv1 upload_file\\\">\"+_vm._ssrEscape(_vm._s(_vm.webInput ? '重新选择方式' : '网络调用封面'))+\"</button>\"):\"<!---->\")+\" \"+((_vm.webInput)?(\"<input type=\\\"text\\\" placeholder=\\\"完整图片的路径 如 http://xxxxx/xxxxx/xx.jpg\\\"\"+(_vm._ssrAttr(\"value\",(_vm.webPath)))+\">\"):\"<!---->\")+\" <span\"+(_vm._ssrClass(null,['file-path', { 'file-path-max': _vm.filePath }]))+\">\"+_vm._ssrEscape(_vm._s(_vm.filePath))+\"</span> \"+((_vm.filePath && !_vm.uploadPath)?(\"<button class=\\\"button-lv1 upload_file\\\">确认上传</button>\"):\"<!---->\")+\" \"+((_vm.filePath || _vm.webPath)?(\"<div class=\\\"img-look-box\\\"><span class=\\\"look\\\">预览区域</span> \"+((!_vm.uploadPath && !_vm.webPath)?(\"<span class=\\\"look-info\\\">等待 确认上传 ...</span>\"):(\"<img\"+(_vm._ssrAttr(\"src\",_vm.webPath || ('//slmblog.com/img/upload/' + _vm.uploadPath)))+\">\"))+\"</div>\"):\"<!---->\")+\"</li></ul> <label class=\\\"content-title\\\">文章内容</label> \"),_c('Editor',{ref:\"editor\"}),_vm._ssrNode(\" <button class=\\\"button-lv0 button-lv1 send\\\">\"+_vm._ssrEscape(_vm._s(!_vm.editor ? '发表' : '保存'))+\"</button>\")],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Editor from '~/plugins/Editor'\r\nimport API from '~/store/API'\r\n\r\nimport axiosQs from 'qs'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      filePath: null,\r\n      uploadPath: null,\r\n      webInput: false,\r\n      webPath: null,\r\n      title: null,\r\n      type: null,\r\n      editor: false,\r\n      description: null\r\n    }\r\n  },\r\n  mounted () {\r\n    // 编辑文章模式\r\n    const that = this\r\n    that.editor = that.$route.query.editor\r\n    if (!isNaN(that.editor)) {\r\n      // 请求文章\r\n      that.$axios\r\n        .get('article/editorArticle/' + that.editor, {\r\n          data: {\r\n            token: that.$store.state.user.token\r\n          }\r\n        })\r\n        .then(res => {\r\n          that.$refs.editor.Stores.set(res.content)\r\n          that.type = res.type\r\n          that.title = res.title\r\n          that.webPath = res.img\r\n          if (that.webPath && that.webPath.indexOf('//') === -1) {\r\n            that.webPath = `${API.IP.img}/img/upload/${that.webPath}`\r\n          }\r\n          that.description = res.description\r\n        })\r\n        .catch(err => {\r\n          that.observer.emit('toast', err)\r\n          that.$router.go(-1)\r\n          throw Error(err)\r\n        })\r\n    }\r\n  },\r\n  methods: {\r\n\r\n    /**\r\n     * 实时路径\r\n     */\r\n    imgChange (e) {\r\n      this.filePath = e.target.value\r\n    },\r\n\r\n    /**\r\n     * 上传封面\r\n     */\r\n    upload (e) {\r\n      let file = this.$refs.uploadFile.files[0]\r\n      if (file) {\r\n        let image = new FormData()\r\n        image.append('file', file)\r\n        this.$axios\r\n          .post('https://io.slmblog.com/i.php?token=' + this.$store.state.user.token, image, {\r\n            headers: { 'Content-Type': 'multipart/form-data' }\r\n          })\r\n          .then(res => {\r\n            if (res.data) {\r\n              if (res.data[0]) {\r\n                this.uploadPath = res.data[0]\r\n                this.webPath = null\r\n              }\r\n            } else {\r\n              console.log(res)\r\n            }\r\n          })\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 发表文章按钮\r\n     */\r\n    send () {\r\n      const that = this\r\n      that.editor = that.$route.query.editor\r\n      const content = that.$refs.editor.editorContent\r\n\r\n      let err = (!that.title || that.title.length < 4)\r\n        ? '标题不能为空或过短!'\r\n        : (!that.type || that.type.split('#').length < 1)\r\n          ? '至少一个分类!'\r\n          : content.length < 10\r\n            ? '这么点字...水军吧!!!'\r\n            : false\r\n\r\n      if (err) {\r\n        that.observer.emit('toast', {\r\n          text: err,\r\n          icon: 'wrong',\r\n          time: 4000\r\n        })\r\n      } else {\r\n        let _user = that.$store.state.user\r\n        let type = isNaN(that.editor) ? 'ARTICLE_ADD' : 'ARTICLE_UNEDITOR'\r\n\r\n        that.$axios.api(type).post({\r\n          token: _user.token,\r\n          title: that.title,\r\n          type: that.type,\r\n          content,\r\n          uid: _user.id,\r\n          img: that.webPath || that.uploadPath,\r\n          description: that.description,\r\n          editor: that.editor || false\r\n        })\r\n          .then(res => {\r\n            if (res.ID) {\r\n              that.$router.push({\r\n                name: 'article-id',\r\n                params: {\r\n                  id: res.ID\r\n                }\r\n              })\r\n              that.$refs.editor.Stores.clear()\r\n            }\r\n          })\r\n      }\r\n    }\r\n  },\r\n  components: { Editor }\r\n}\r\n\r\n","import mod from \"-!../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./editArticle.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./editArticle.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./editArticle.vue?vue&type=template&id=3f070aec&\"\nimport script from \"./editArticle.vue?vue&type=script&lang=js&\"\nexport * from \"./editArticle.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./editArticle.vue?vue&type=style&index=0&lang=less&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"6b3ebc4c\"\n  \n)\n\nexport default component.exports","// Exports\nmodule.exports = {};\n","// Exports\nmodule.exports = {};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"editor\",staticStyle:{\"text-align\":\"left\"}},[])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n\r\nimport 'wangeditor/release/wangEditor.css'\r\nimport E from 'wangeditor/release/wangEditor.js'\r\nexport default {\r\n  name: 'editor',\r\n  props: ['model'],\r\n  data () {\r\n    return {\r\n      editorContent: ''\r\n    }\r\n  },\r\n  mounted () {\r\n    let editor = new E(this.$refs.editor)\r\n\r\n    let inster = null\r\n\r\n    // 留言模式下的編輯器\r\n    if (this.model === 'send') {\r\n      editor.customConfig.menus = [\r\n        'italic',\r\n        'underline',\r\n        'strikeThrough',\r\n        'foreColor',\r\n        'backColor',\r\n        'link',\r\n        'quote',\r\n        'image',\r\n        'emoticon',\r\n        'image',\r\n        'table',\r\n        'undo',\r\n        'redo'\r\n      ]\r\n    }\r\n    // 自动保存编辑器内容\r\n    let Store = (function (self) {\r\n      return class {\r\n        // IO存储的数据对象\r\n        value = {}\r\n        // 当前路由\r\n        path = self.$router.history.current.path\r\n\r\n        constructor () {\r\n          let stroe = localStorage.getItem('editor')\r\n          let _this = this\r\n          if (stroe) {\r\n            _this.value = JSON.parse(localStorage.getItem('editor'))\r\n          }\r\n          // 如果上次未编辑完则保存\r\n          if (_this.value[_this.path]) {\r\n            editor.txt.html(_this.value[_this.path])\r\n          }\r\n        }\r\n\r\n        // 清空编辑器内容\r\n        clear () {\r\n          this.set()\r\n          editor.txt.html('')\r\n        }\r\n\r\n        set (val) {\r\n          this.value[this.path] = val\r\n          if (!val) delete this.value[this.path]\r\n          localStorage.setItem('editor', JSON.stringify(this.value))\r\n        }\r\n      }\r\n    })(this)\r\n\r\n    // 输入时赋值到全局\r\n    editor.customConfig.onchange = (html) => {\r\n      this.editorContent = html\r\n      clearTimeout(inster)\r\n      inster = setTimeout(() => {\r\n        this.Stores.set(this.editorContent)\r\n      }, 1500)\r\n    }\r\n\r\n    let imgRoot = '/img/emoji/'\r\n    editor.customConfig.uploadImgServer = this.$store.state.user ? 'http://res.mczyzy.cn/file/i.php?token=' + this.$store.state.user.token : false\r\n    editor.customConfig.imgIp = '/img/upload/'\r\n    // 表情配置\r\n    let lyList = []\r\n    let i = 1\r\n    for (i; i < 21; i++) {\r\n      lyList.push({\r\n        alt: '加載中...',\r\n        src: `${imgRoot}${i}.jpg`,\r\n        style: 'width: 59px'\r\n      })\r\n    }\r\n    editor.customConfig.emotions = [\r\n      {\r\n        title: '凜音',\r\n        type: 'image',\r\n        content: lyList\r\n      }\r\n    ]\r\n    editor.create()\r\n    this.Stores = new Store()\r\n  }\r\n}\r\n","import mod from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Editor.vue?vue&type=template&id=79083468&\"\nimport script from \"./Editor.vue?vue&type=script&lang=js&\"\nexport * from \"./Editor.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  \"6c9a319a\"\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--5-oneOf-1-0!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--5-oneOf-1-1!../../node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js??ref--5-oneOf-1-2!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./editArticle.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--5-oneOf-1-0!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--5-oneOf-1-1!../../node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js??ref--5-oneOf-1-2!../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./editArticle.vue?vue&type=style&index=0&lang=less&\""],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AADA;AADA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;AACA;AACA;AACA;AADA;AAFA;AAMA;AACA;AACA;AACA;AACA;AACA;AAnFA;AAoFA;AAAA;AAAA;AA9HA;;ACpDA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvBA;AACA;;;;;;;;ACDA;AACA;;;;;;;;;;;ACDA;AACA;AACA;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAeA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AAGA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AAjGA;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}