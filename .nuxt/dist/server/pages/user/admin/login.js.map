{"version":3,"file":"pages/user/admin/login.js","sources":["webpack:///./pages/user/admin/login.vue?356a","webpack:///./pages/user/admin/login.vue","webpack:///./pages/user/admin/login.vue?61a8","webpack:///./pages/user/admin/login.vue?729c","webpack:///./static/img/account-bg3.jpg","webpack:///./pages/user/admin/login.vue?73d0","webpack:///./pages/user/admin/login.vue?e487"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"conter\"},[_vm._ssrNode(\"<div class=\\\"account clearfix\\\">\",\"</div>\",[_vm._ssrNode(\"<img\"+(_vm._ssrAttr(\"src\",require('~/static/img/account-bg3.jpg')))+\" alt=\\\"图1\\\" class=\\\"border-line\\\"> <form action><label>账号</label> <input type=\\\"text\\\" name=\\\"log_user\\\"\"+(_vm._ssrAttr(\"value\",(_vm.login.user)))+\" class=\\\"input-1v\\\"> <label>密码</label> <input type=\\\"password\\\" name=\\\"log_pass\\\" autocomplete=\\\"tel\\\"\"+(_vm._ssrAttr(\"value\",(_vm.login.rsa.pass)))+\" class=\\\"input-1v\\\"> <span class=\\\"button-lv0\\\">登陆</span></form> \"),_vm._ssrNode(\"<span class=\\\"account-right\\\">\",\"</span>\",[_vm._ssrNode(\"<a\"+(_vm._ssrAttr(\"href\",_vm.qqLoginUrl))+\" target=\\\"_black\\\" rel=\\\"noopener noreferrer\\\"><i class=\\\"iconfont icon-ziyuan\\\"></i> <span>QQ登录</span></a> \"),_c('nuxt-link',{attrs:{\"to\":\"register\"}},[_c('i',{staticClass:\"iconfont icon-zhuce\"}),_vm._v(\" \"),_c('span',[_vm._v(\"注册账号\")])])],2)],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      login: {\r\n        user: null,\r\n        rsa: {\r\n          pass: null\r\n        }\r\n      },\r\n      uid: Date.now(),\r\n      qqLoginUrl: \"not url\",\r\n      page: \"login\"\r\n    };\r\n  },\r\n  created() {\r\n    this.page = this.$route.name === \"register\" ? \"register\" : \"login\";\r\n    this.qqLoginUrl =\r\n      \"https://graph.qq.com/oauth2.0/show?which=Login&display=pc&response_type=code&client_id=101540984&display=mobile&redirect_uri=http%3A%2F%2Fmczyzy.cn%3A8080%2Fqqlogin%2Fcallback&state=\" +\r\n      this.uid;\r\n    this.$store.state.mobile &&\r\n      (this.qqLoginUrl =\r\n        \"https://xui.ptlogin2.qq.com/cgi-bin/xlogin?appid=716027609&pt_3rd_aid=101540984&daid=383&pt_skey_valid=1&style=35&s_url=http%3A%2F%2Fconnect.qq.com&refer_cgi=authorize&which=&client_id=101540984&response_type=code&redirect_uri=http%3A%2F%2Fmczyzy.cn%3A8080%2Fqqlogin%2Fcallback&state=\" +\r\n        this.uid +\r\n        \"&scope=get_user_info%2Cadd_share%2Cadd_t%2Cadd_pic_t%2Cget_repost_list&display=mobile\");\r\n    // 移动端 qq登录兼容\r\n    if (this.$router.history.current.query.state) {\r\n      this.qqLoginState();\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n     * 登录按钮点击事件\r\n     */\r\n    loginEvent() {\r\n      let that = this;\r\n      let toast = {\r\n        text: `登录成功,欢迎回来 [${that.login.user}]!`,\r\n        icon: \"success\",\r\n        hideTime: 4000\r\n      };\r\n      if (that.login.user && that.login.rsa.pass) {\r\n        that.$axios\r\n          .api(\"USER_LOGIN\")\r\n          .get({\r\n            data: {\r\n              ...that.login\r\n            }\r\n          })\r\n          .then(res => {\r\n            if (!res.error) {\r\n              window.localStorage.setItem(\"userInfo\", JSON.stringify(res))\r\n              that.$store.dispatch(\"USER\", res)\r\n              that.observer.emit(\"toast\", {\r\n                icon: \"zhiwen\",\r\n                text: `登录成功,欢迎回来 [${that.login.user}]!`,\r\n                time: false,\r\n                select: [\r\n                  {\r\n                    value: \"管理账号\",\r\n                    action: () => {}\r\n                  },\r\n                  {\r\n                    value: \"个人中心\",\r\n                    action: () => {\r\n                      that.$router.push({\r\n                        path: \"/user/\" + res.id\r\n                      });\r\n                      return true\r\n                    }\r\n                  }\r\n                ]\r\n              })\r\n              that.observer.emit('HeaderRouter')\r\n              const page = that.$route.query.page\r\n              if (page) {\r\n                that.$router.push({ path: page })\r\n              } else {\r\n                that.$router.push({ path: \"/\" })\r\n              }\r\n            } else that.observer.emit(\"toast\", res)\r\n          })\r\n      } else\r\n        that.observer.emit(\"toast\", {\r\n          icon: \"wrong\",\r\n          text: \"请将信息先写完整!\"\r\n        })\r\n    },\r\n\r\n    /**\r\n     * 点击QQ登录后，进行窗口检测\r\n     */\r\n    qqLogin() {\r\n      window.addEventListener(\"blur\", blur)\r\n      let self = this\r\n      function blur() {\r\n        // 当用户关闭授权窗口后 或者 取消授权 回到本窗口时\r\n        window.addEventListener(\"focus\", focus)\r\n        function focus() {\r\n          window.removeEventListener(\"blur\", blur)\r\n          window.removeEventListener(\"focus\", focus)\r\n\r\n          // 检测授权uid是否存在服务器中\r\n          self.qqLoginState()\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 检测QQ授权\r\n     */\r\n    qqLoginState(state) {\r\n      let self = this\r\n      let uid = this.$router.history.current.query.state || self.uid\r\n      let toast = {\r\n        text: `QQ登录授权失败!`,\r\n        icon: \"error\",\r\n        hideTime: 4000\r\n      };\r\n      self.$axios\r\n        .get(\"qqLogin/exists\", { uid })\r\n        .then(res => {\r\n          // 授权uid存在\r\n          if (res.data.value) {\r\n            // window.localStorage.setItem('userInfo', JSON.stringify(res.data))\r\n            self.$store.state.user = JSON.parse(JSON.parse(res.data.value))\r\n            toast.icon = \"success\"\r\n            toast.text = `授权成功, 欢迎回来 [${\r\n              self.$store.state.user.nickname\r\n            }]!`\r\n            self.$connecter.$emit(\r\n              \"user\",\r\n              JSON.parse(JSON.parse(res.data.value))\r\n            );\r\n            self.$connecter.$emit(\"page\", { toast })\r\n          } else {\r\n            toast.text = `授权失败, 回调值错误!`;\r\n            self.$connecter.$emit(\"page\", { toast })\r\n          }\r\n        })\r\n        .catch(() => {\r\n          self.$connecter.$emit(\"page\", { toast })\r\n        });\r\n    }\r\n  }\r\n};\r\n","import mod from \"-!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=b737ffae&\"\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./login.vue?vue&type=style&index=0&lang=less&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"4fd8320e\"\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/account-bg3.df990ad.jpg\";","// Exports\nmodule.exports = {};\n","import mod from \"-!../../../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--5-oneOf-1-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--5-oneOf-1-1!../../../node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js??ref--5-oneOf-1-2!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--5-oneOf-1-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--5-oneOf-1-1!../../../node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js??ref--5-oneOf-1-2!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&lang=less&\""],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAFA;AAMA;AACA;AACA;AATA;AAWA;AACA;AAAA;AACA;AACA;AAGA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AAGA;AAAA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAKA;AACA;AACA;AACA;AADA;AAGA;AACA;AAPA;AATA;AAoBA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAIA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AAIA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAlHA;AA7BA;;ACnCA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvBA;;;;;;;ACAA;AACA;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}